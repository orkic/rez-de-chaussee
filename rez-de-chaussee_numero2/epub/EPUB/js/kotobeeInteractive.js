function kInteractionStart(){this.log=function(e){},kInteractive.setDOMParser(),kInteractive.preRender(),kInteractive.postRender()}function kInteractionStartSingleElem(e){this.log=function(e){},kInteractive.setDOMParser(),kInteractive.preRender(e,!0),kInteractive.postRender(e,!0)}var kInteractive={scormWrapper:null,preRender:function(e,t){new DOMParser;var n,i=e||document;t?(n=[e],i=document):n=i.getElementsByClassName("kInteractive");for(var a=n.length;a--;){var r=n[a];if(this.hasClass(r,"gallery")){var o=i.createDocumentFragment(),s=kInteractive.readData(r);r.innerHTML="";var c=document.createElement("div");c.className="images "+s.scale;for(k=0;k<s.imgs.length;k++){var d=document.createElement("div");d.className="imgContainer"+(k?"":" selected");W="undefined"==typeof isKotobee?s.imgs[k].path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,s.imgs[k].path);d.setAttribute("style","background-color:"+s.bgColor+";background-image:url('"+W+"')"+(k?"":";display:block")),c.appendChild(d)}o.appendChild(c);var l=document.createElement("a");l.className="next btn ki-btn",1==s.imgs.length&&(l.className+=" disable"),o.appendChild(l);var u=document.createElement("a");u.className="prev btn ki-btn disable",o.appendChild(u),"undefined"==typeof isKotobee&&(l.addEventListener("click",this.actionEvent),u.addEventListener("click",this.actionEvent)),r.appendChild(o)}if(this.hasClass(r,"questions")){var o=i.createDocumentFragment(),m=kInteractive.readData(r);m.options||(m.options={}),r.id||(r.id="ki-qs-"+a+"-"+Math.ceil(1e3*Math.random()));if(r.innerHTML="",m.layout&&m.layout.popup&&!this.hasClass(r,"inpopup")){var p=document.createElement("img"),h=m.layout.popupImg;return p.src=h,o.appendChild(p),"undefined"==typeof isKotobee&&p.addEventListener("click",this.actionEvent),void r.appendChild(o)}if(m.options.randomize){for(k=0;k<m.q.length;k++)m.q[k].origin=k;for(var v,f,g=m.q.length;0!==g;)f=Math.floor(Math.random()*g),g-=1,v=m.q[g],m.q[g]=m.q[f],m.q[f]=v}if(m.options.questionsDisplayed){var y=Number(m.options.questionsDisplayed);m.q=m.q.slice(0,y)}if(m.title){var b=document.createElement("span");b.innerHTML="<h4>"+kInteractive.escapeHtml(m.title)+"</h4>",o.appendChild(b)}for(var k=0;k<m.q.length;k++){var I=m.q[k],C=document.createElement("div");if(C.className="ques",null!=I.origin&&C.setAttribute("data-o",I.origin),C.innerHTML="<p><strong>"+(k+1)+". "+kInteractive.escapeHtml(I.q)+"</strong></p>",I.path){var E=document.createElement("img");E.src=I.path,C.appendChild(E)}if("sa"==I.type){var w=I.lines?I.lines:1,N=document.createElement(w>1?"textarea":"input");N.name="sa-"+k,1==w?N.type="text":N.rows=I.lines?I.lines:1,N.className="ans txtfield";T="ki-sa-"+a+"-"+k;N.id=T,document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[k]&&(N.value=document[r.id].q[k]),C.appendChild(N)}else if("mcq"==I.type||"mmcq"==I.type)for(var A=I.c,x=0;x<A.length;x++){var T="ki-mcq-"+a+"-"+k+"-"+x,q=document.createElement("input");"mmcq"==I.type?(q.name="name",q.type="checkbox"):(q.name="mcq-"+k,q.type="radio"),q.className="ans",q.id=T,(P=document.createElement("label")).htmlFor=T,P.innerHTML=" "+kInteractive.escapeHtml(A[x].t)+"<br/>",P.className="ki-noHighlight",(B=document.createElement("div")).className="answer",document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[k]&&(q.checked=document[r.id].q[k][x],m.options&&m.options.highlightCorrect&&m.q[k].c[x].a&&kInteractive.c.addClass(B,"correct")),B.appendChild(q),B.appendChild(P),C.appendChild(B)}else if("tf"==I.type)for(x=0;x<2;x++){var T="ki-tf-"+a+"-"+k+"-"+x,L=document.createElement("input");L.type="radio",L.name="tf-"+k,L.className="ans",L.id=T,(P=document.createElement("label")).htmlFor=T,I.choice1&&I.choice2?P.innerHTML=kInteractive.escapeHtml(" "+(0==x?I.choice1:I.choice2)):P.innerHTML=" "+(0==x?"True":"False"),P.className="ki-noHighlight";var B=document.createElement("div");document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[k]&&(L.checked=document[r.id].q[k][x],m.options&&m.options.highlightCorrect&&(0==x&&m.q[k].a||1==x&&!m.q[k].a)&&kInteractive.c.addClass(B,"correct")),B.appendChild(L),B.appendChild(P),C.appendChild(B)}if((j=document.createElement("p")).className="separator",C.appendChild(j),document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[k]&&m.q[k].exp&&!C.getElementsByClassName("explanation").length){var S=document.createElement("p");S.className="explanation",S.innerHTML=kInteractive.escapeHtml(m.q[k].exp),C.appendChild(S)}o.appendChild(C)}if(m.options.emailForm){var R=document.createElement("div");R.setAttribute("class","emailForm"),function(e,t,n){var i=document.createElement("div");i.className="address",i.innerHTML="<p><strong>"+e+"</strong><em>"+t+"</em></p>";var a=document.createElement("input");a.name=n,a.type="text",a.className="txtfield",i.appendChild(a);var r=document.createElement("p");r.className="separator",i.appendChild(r),R.appendChild(i)}(m.dict?m.dict.recipientEmail:"Recipient email",m.dict?m.dict.separateEmails:"Separate multiple emails with commas","recipientEmail"),o.appendChild(R)}var O=null;if("none"!=m.action){var H="ki-"+a+"-btn";(O=document.createElement("input")).type="submit",O.value=m.dict?m.dict.submit:"Submit Answers",O.id=H,O.className="btn ki-btn ki-mcq"}var M=null,D=null;if(m.options&&(m.options.clearAnswers&&((M=document.createElement("input")).type="submit",M.value=m.dict?m.dict.clear:"Clear Answers",M.className="btn ki-btn ki-questions questions-clear","undefined"==typeof isKotobee&&M.addEventListener("click",this.actionEvent)),m.options.addToNotebook&&((M=document.createElement("input")).type="submit",M.value=m.dict?m.dict.notebook:"Save to Notebook",M.className="btn ki-btn ki-questions questions-notebook","undefined"==typeof isKotobee&&M.addEventListener("click",this.actionEvent)),m.options.preserveAnswers)){(D=document.createElement("div")).style.marginTop="5px";var F=document.createElement("input");F.type="checkbox",F.name="preserveAnswers",F.className="ki-btn ki-questions questions-preserve",F.id="ki-"+a+"-preserveAnswersBtn",document[r.id]&&(F.checked=document[r.id].preserve),D.appendChild(F);var P=document.createElement("label");P.htmlFor=F.id,P.innerHTML=" "+(m.dict?m.dict.preserve:"Preserve submitted answers"),P.className="ki-noHighlight",D.appendChild(P),"undefined"==typeof isKotobee&&F.addEventListener("change",this.actionEvent)}"undefined"==typeof isKotobee&&O&&O.addEventListener("click",this.actionEvent),O&&o.appendChild(O),o.appendChild(document.createTextNode(" ")),M&&o.appendChild(M),D&&o.appendChild(D);var j=document.createElement("p");j.className="separator",o.appendChild(j),m.options.rtl?r.style.direction="rtl":r.style.direction="ltr",r.appendChild(o)}if(this.hasClass(r,"image")){if(r.parentNode&&this.hasClass(r.parentNode,"link"))continue;"undefined"==typeof isKotobee&&r.addEventListener("click",this.actionEvent)}if(this.hasClass(r,"link")){var z=kInteractive.readData(r);if("undefined"!=typeof editorMode&&editorMode)continue;if("div"==r.nodeName.toLowerCase()){var K=document.createElement("a");K.setAttribute("href","popup"==z.type?"":r.getAttribute("href")),K.setAttribute("target",z.target),K.setAttribute("style",r.getAttribute("style")),K.setAttribute("data-kotobee",r.getAttribute("data-kotobee")),K.className="kInteractive link btn",K.style.opacity=Number(z.transparency)/100,r.parentNode.replaceChild(K,r),r=K}"undefined"==typeof isKotobee&&("popup"==z.type&&r.setAttribute("onclick","return false;"),r.addEventListener("click",this.actionEvent))}if(this.hasClass(r,"container")){var U=kInteractive.readData(r);if(U.path){var W=U.path;"undefined"!=typeof isKotobee&&(W=ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,U.path));var V=r.getAttribute("style");r.setAttribute("style",V+' background-image:url("'+W+'");')}"cScroll"==U.type&&kInteractive.isMobile()&&(r.style.minHeight=r.style.height,r.style.height="auto",r.style.overflowY=null)}}},clearAudioVideo:function(e){var t=e||document;kInteractive.stopCurrentMedia();for(var n=t.getElementsByTagName("audio"),i=n.length;i--;)try{n[i].pause(),n[i].children.length||(n[i].src="")}catch(e){}for(var a=t.getElementsByTagName("video"),i=a.length;i--;)a[i].pause(),a[i].children.length||(a[i].src="")},postRender:function(e,t){kInteractive.videoIsFullscreen=!1,kInteractive.timestamp=new Date,kInteractive.currentVideo=kInteractive.currentAudio=null,kInteractive.clearAudioVideo(e);var n,i=e||document;t?(n=[e],i=document):n=i.getElementsByClassName("kInteractive");for(var a=n.length;a--;){var r=n[a];if(this.hasClass(r,"questions")){for(var o=kInteractive.readData(r),s=r.getElementsByClassName("ques"),c=r.getElementsByClassName("explanation"),d=c.length;d--;)c[d].parentNode.removeChild(c[d]);for(var l=0;l<s.length;l++){var u=s[l].getElementsByClassName("ans"),m=(u.length,l);if(o.options.randomize&&(m=Number(s[l].getAttribute("data-o"))),document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[m]&&o.q[m].exp&&!s[l].getElementsByClassName("explanation").length){var p=document.createElement("p");p.className="explanation",p.innerHTML=kInteractive.escapeHtml(o.q[m].exp),s[l].appendChild(p)}for(d=0;d<u.length;d++)kInteractive.c.removeClass(u[d].parentNode,"correct"),u[d].getAttribute("id").indexOf("ki-tf-")>=0?document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[m]&&(u[d].checked=document[r.id].q[m][d],o.options&&o.options.highlightCorrect&&(0==d&&o.q[m].a||1==d&&!o.q[m].a)&&kInteractive.c.addClass(u[d].parentNode,"correct")):u[d].getAttribute("id").indexOf("ki-sa-")>=0?document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[m]&&(u[d].value=document[r.id].q[m]):document[r.id]&&document[r.id].preserve&&document[r.id].q&&document[r.id].q[m]&&(u[d].checked=document[r.id].q[m][d],o.options&&o.options.highlightCorrect&&o.q[m].c[d].a&&kInteractive.c.addClass(u[d].parentNode,"correct"));if(document[r.id]){var h=r.getElementsByClassName("questions-preserve");h.length&&(h[0].checked=document[r.id].preserve)}}}else if(this.hasClass(r,"widget")){var v,f=i.createDocumentFragment(),g=kInteractive.readData(r);v=g.path?"undefined"==typeof isKotobee?g.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,g.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/";var y=g.name,b=g.src,k=g.width,I=g.height;if("page"==g.mode){if(r.children.length)return;var C=document.createElement("div");C.className="cover",f.appendChild(C),g.interaction&&(C.style.pointerEvents="none");var E=document.createElement("div");E.className="iframeContainer";var w=document.createElement("iframe");w.setAttribute("nwdisable","true"),w.setAttribute("nwfaketop","true"),w.setAttribute("width",r.style.width?r.style.width:k+g.widthUnit),w.setAttribute("height",r.style.height?r.style.height:I+"px"),w.src=v+"/"+y+"/"+b,E.appendChild(w),f.appendChild(E);var N=r.style.width,A=r.style.height;N.indexOf("px")>=0&&(g.widthUnit="px"),N.indexOf("%")>=0&&(g.widthUnit="%");try{g.widthUnit?g.width=Number(N.split(g.widthUnit)[0]):g.width=Number(N)}catch(e){g.width=Number(N)}try{g.height=Number(A.split("px")[0])}catch(e){g.height=Number(A)}kInteractive.writeData(r,g)}else{if(r.setAttribute("wdgt-src",b),r.setAttribute("wdgt-name",y),!r.children.length&&!r.innerHTML.trim()){var x=document.createElement("img");x.src=v+"/"+y+"/Icon.png",f.appendChild(x)}"undefined"==typeof isKotobee&&r.addEventListener("click",this.actionEvent)}r.appendChild(f)}else if(this.hasClass(r,"video")){var f=i.createDocumentFragment(),T=kInteractive.readData(r),q="";if(T.splash&&(q="undefined"==typeof isKotobee?T.splash:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,T.splash)),q){r.style.backgroundImage=null;var L=r.style.cssText;r.setAttribute("style","background-image:url('"+q+"');"+L)}r.setAttribute("id","ki-video-"+a),r.innerHTML="",(B=document.createElement("div")).setAttribute("id","ki-video-"+a+"-container"),B.className="container",(S=document.createElement("a")).className="playBtn ki-btn","undefined"==typeof isKotobee&&S.addEventListener("click",this.actionEvent),f.appendChild(S),f.appendChild(B),r.appendChild(f),T.autoplay&&kInteractive.action(r)}else if(this.hasClass(r,"audio")){f=i.createDocumentFragment(),kInteractive.readData(r);r.setAttribute("id","ki-audio-"+a),r.innerHTML="";var B=document.createElement("div");B.setAttribute("id","ki-audio-"+a+"-container"),B.className="container";var S=document.createElement("a");S.className="playBtn ki-btn","undefined"==typeof isKotobee&&S.addEventListener("click",this.actionEvent),f.appendChild(S),f.appendChild(B),r.appendChild(f)}else if(this.hasClass(r,"threed")){var f=i.createDocumentFragment(),R=kInteractive.readData(r);r.innerHTML="";var O=r.getAttribute("style");R.inter.placeholderPath&&(O+="background-image:url('"+("undefined"==typeof isKotobee?R.inter.placeholderPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,R.inter.placeholderPath))+"');"),r.setAttribute("style",O);var H=document.createElement("a");R.inter.includeMsg?(H.innerHTML=kInteractive.escapeHtml(R.inter.msg),H.className="msgBtn ki-btn"):H.className="invisibleBtn ki-btn",f.appendChild(H),"undefined"==typeof isKotobee&&H&&H.addEventListener("click",this.actionEvent),r.appendChild(f)}else if(this.hasClass(r,"gallery"));else if(this.hasClass(r,"image")){var M=kInteractive.readData(r);M.behavior&&"none"!=M.behavior||(r.style.transition=r.style.webkitTransition=r.style.mozTransition="none")}}this.firstRun&&(window.addEventListener("resize",function(n){kInteractive.resizeEvent(e,t)}),this.firstRun=!1),kInteractive.resizeEvent(e,t)},actionEvent:function(e){kInteractive.action(e.target)},action:function(e,t){function n(e){for(var t=0;e=e.previousSibling;)"#text"!=e.nodeName&&8!=e.nodeType&&t++;return t}function i(){var e="Questions: "+p+". Score: "+v+" questions out of "+g;e+=". Action: "+P,"selfAnswerReport"==P&&(e+=". Details: "+y),kInteractive.tinCan({verb:"solved",activity:e})}function a(){se||(kInteractive.c.addClass(de,"hide"),se=!0)}function r(e,t){e.style.webkitAnimation=e.style.mozAnimation=e.style.animation=t}function o(e,t){e.style.webkitAnimationDuration=e.style.mozAnimationDuration=e.style.animationDuration=t}function s(e,t){e.style.webkitAnimationIterationCount=e.style.mozAnimationIterationCount=e.style.animationIterationCount=t}function c(e){var t=document.createElement("video");t.setAttribute("width","100%"),t.setAttribute("height","100%"),t.setAttribute("src",e),t.setAttribute("autoplay","true"),t.setAttribute("data-tap-disabled","false");var n;0!=e.indexOf("http://")&&0!=e.indexOf("https://")||(n=!0),n&&t.setAttribute("crossorigin","anonymous"),t.setAttribute("type","video/mp4"),t.setAttribute("webkit-playsinline","true"),t.setAttribute("controls","true"),t.className="ki-noHighlight",Ie.hideDownloadBtn&&(t.className+=" hideDownloadBtn"),t.innerHTML="Your browser doesn't support HTML5 video.",n&&(t.crossOrigin="anonymous"),t.oncanplay=function(){kInteractive.currentVideo==l&&(Ee.className="playBtn ki-btn hide",kInteractive.tinCan({verb:"played",activity:"Video: "+e}))},t.addEventListener("error",function(e){kInteractive.stopCurrentMedia()}),t.addEventListener("webkitfullscreenchange",function(e){var t=null!==document.webkitFullscreenElement;kInteractive.videoIsFullscreen=t});var i=l.getElementsByClassName("container")[0];i.setAttribute("data-tap-disabled","true"),i.appendChild(t)}function d(){function e(e){function n(t){if(!(t>=qe.objects.length)){var i=qe.objects[t],r="undefined"==typeof isKotobee?i.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,i.path);new THREE.OBJLoader(d).load(r,function(r){Le&&Le.parentNode&&Le.parentNode.removeChild(Le),a.domElement.parentNode||e.appendChild(a.domElement),r.position.set(i.x,i.y,i.z),r.traverse(function(e){if(e instanceof THREE.Mesh){var a=e==r.children[r.children.length-1];if(i.textPath){var o=new THREE.ImageLoader(d),s="undefined"==typeof isKotobee?i.textPath:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,i.textPath);o.load(s,function(i){var o=new THREE.Texture;o.image=i,o.needsUpdate=!0,e.material.map=o,a&&c.add(r),n(++t)},function(){},function(e){})}else a&&c.add(r),n(++t)}})},function(e){e.lengthComputable&&(e.loaded,e.total)},function(e){})}}function i(){a.render(c,s);g.getDelta();t=requestAnimFrame(i)}kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("_3D",qe.name?qe.name:"Model"),e.description="Opened 3D model: "+(qe.name?qe.name:"No name"),e.learnerResponses="Viewed",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800),t&&cancelAnimationFrame(t);var a;a=function(){try{var e=document.createElement("canvas");return!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(e){return!1}}()?new THREE.WebGLRenderer({precision:"highp"}):new THREE.CanvasRenderer;var r=e.offsetWidth,o=e.offsetHeight,s=new THREE.PerspectiveCamera(qe.camera.viewAngle,r/o,qe.camera.near,qe.camera.far),c=new THREE.Scene;null!=qe.scene.bgColor&&a.setClearColor(qe.scene.bgColor,1),c.add(s),s.position.x=qe.camera.x,s.position.y=qe.camera.y,s.position.z=qe.camera.z,a.setSize(r,o),qe.scene.floor&&(floor=new THREE.Mesh(new THREE.PlaneGeometry(500,500,1,1),new THREE.MeshPhongMaterial({color:qe.scene.floorColor?qe.scene.floorColor:10066329})),floor.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2)),floor.position.y=-80,floor.receiveShadow=!0,c.add(floor));var d=new THREE.LoadingManager;d.onProgress=function(e,t,n){},n(0),new THREE.OrbitControls(s,a.domElement).target=new THREE.Vector3(0,0,0);for(var l=0;l<qe.lights.length;l++)if("pointLight"==qe.lights[l].type){var u=new THREE.PointLight(qe.lights[l].color);u.position.set(qe.lights[l].x,qe.lights[l].y,qe.lights[l].z),c.add(u)}else if("directionalLight"==qe.lights[l].type){var m=new THREE.DirectionalLight(qe.lights[l].color,qe.lights[l].intensity);m.position.set(qe.lights[l].x,qe.lights[l].y,qe.lights[l].z),c.add(m)}else if("hemisphereLight"==qe.lights[l].type){var p=new THREE.HemisphereLight(qe.lights[l].sky,qe.lights[l].ground,qe.lights[l].intensity);p.position.set(qe.lights[l].x,qe.lights[l].y,qe.lights[l].z),c.add(p)}else if("spotLight"==qe.lights[l].type){var h=new THREE.SpotLight(qe.lights[l].color,qe.lights[l].intensity,qe.lights[l].distance,qe.lights[l].angle,qe.lights[l].exponent,qe.lights[l].decay);h.position.set(qe.lights[l].x,qe.lights[l].y,qe.lights[l].z),c.add(h)}else if("ambientLight"==qe.lights[l].type){var v=new THREE.AmbientLight(qe.lights[l].color);c.add(v)}else if("areaLight"==qe.lights[l].type){var f=new THREE.AreaLight(qe.lights[l].color,qe.lights[l].intensity);c.add(f)}var g=new THREE.Clock;i()}var t,n=l;if("inPanel"==qe.inter.target){var i={};i.class="threed",i.cb=function(t){var n=document.createElement("div");n.className="container",t.appendChild(n),e(n)},i.closed=function(){kInteractive.c.removeClass(l,"running")},kInteractive.openFrame(i)}else e(n)}if("undefined"==typeof editorMode||!editorMode){for(var l=e;!this.hasClass(l,"kInteractive");)if((l=l.parentNode)==document.body)return;if(this.hasClass(l,"questions")){var u=kInteractive.readData(l);if(u.layout&&u.layout.popup&&!this.hasClass(l,"inpopup")&&"img"==e.nodeName.toLowerCase()){var m=document.getElementById("epubContent");return m&&l.setAttribute("data-loc",function(e,t){for(var i="";e!=t;)i=n(e)+"."+i,e=e.parentNode;return""==i?"":i.substr(0,i.length-1)}(l,m)),(ie=document.createElement("iframe")).setAttribute("nwdisable","true"),ie.setAttribute("nwfaketop","true"),u.cb=function(e){function t(){if("undefined"!=typeof isKotobee){var e={};e.root=ie.contentDocument.documentElement.ownerDocument.body,e.rootIndex=l.getAttribute("data-loc"),angular.element(document.body).scope().getNotebookShortcut(e,function(){})}}var n,i=document.createElement("head");if("undefined"==typeof isKotobee){for(var a=document.getElementsByTagName("link"),r=0;r<a.length;r++){var o=a[r];if(o.getAttribute("href").indexOf("base.css")>=0){var s=o.getAttribute("href").split("/");delete s[s.length-1],n=s.join("/");break}}if(!n)return}var c="undefined"==typeof isKotobee?n+"../xhtml/":bookPath+"EPUB/xhtml/",i="<head>";if(i+='<base href="'+kInteractive.c.removeFilename(kInteractive.c.removeHash(window.location.href))+"/"+c+'"/>',i+='<link rel="stylesheet" type="text/css" href="../css/base.css" />',i+='<link rel="stylesheet" type="text/css" href="../css/global.css" />',i+='<link rel="stylesheet" type="text/css" href="../css/kotobeeInteractive.css" />',i+='<script type="text/javascript" src="../js/kotobeeInteractive.js"><\/script>',i+='<script type="text/javascript" src="../js/global.js"><\/script>',"undefined"!=typeof isKotobee){var d=clone(config);d.kotobee.email=angular.element(document.body).scope().data.user.email,i+='<script type="text/javascript">var config='+JSON.stringify(d)+";<\/script>"}i+='<meta charset="utf-8" />',i+="</head>";var u=l.outerHTML;u=(u=(u=(u=(u=(u=u.replace("<img",'<img style="display:none"')).replace(/([;\s]*?height:)(.*)?;/i,"$1auto")).replace(/([;\s]*?width:)(.*)?;/i,"$1auto")).replace(/([;\s]*?top:)(.*)?;/i,"$1auto")).replace(/([;\s]*?left:)(.*)?;/i,"$1auto")).replace('class="','class="inpopup ');var m="<html>"+i+"<body>"+(u+='<div class="vSpace20"></div>')+"</body></html>";ie.setAttribute("srcdoc",m);var p="javascript: window.frameElement.getAttribute('srcdoc');";ie.setAttribute("src",p),ie.contentWindow&&(ie.contentWindow.location=p),e.appendChild(ie),ie.addEventListener?ie.addEventListener("load",t,!0):ie.attachEvent&&ie.attachEvent("onload",t)},u.closed=function(){},u.pos=u.layout.pos,kInteractive.openFrame(u),kInteractive.tinCan({verb:"opened",activity:"Questions: "+u.title}),void(kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("question",u.title),e.description="Opened question popup: "+u.title,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800))}var p="Untitled questions",h=l.getElementsByTagName("h4");h.length&&(p=h[0].textContent||h[0].data);var v=0,f=l.getElementsByClassName("ques"),g=f.length,y="";if(this.hasClass(e,"kInteractive"))return;if(this.hasClass(e,"questions-clear")){for(var b=l.getElementsByClassName("ans"),k=0;k<b.length;k++)b[k].checked=!1,b[k].value=null,kInteractive.c.removeClass(b[k].parentNode,"correct");for(k=(M=l.getElementsByClassName("explanation")).length;k--;)M[k].parentNode.removeChild(M[k]);return void(document[l.id]=null)}if(this.hasClass(e,"questions-notebook")){var I=u.layout&&u.layout.popup&&this.hasClass(l,"inpopup");if("undefined"==typeof isKotobee&&!I)return void kInteractive.alert({content:u.dict.kotobeeOnly,title:u.dict?u.dict.sorry:"Sorry"});var C,E={elem:l};if("undefined"!=typeof isKotobee)C=angular.element(document.body).scope();else{try{C=window.parent.getGlobal()}catch(e){return void kInteractive.alert({content:u.dict.kotobeeOnly,title:u.dict?u.dict.sorry:"Sorry"})}E.rootIndex=l.getAttribute("data-loc"),E.root=l}return kInteractive.c.addClass(e,"busy"),void C.questionsAddToNotebookShortcut(E,function(){kInteractive.c.removeClass(e,"busy"),kInteractive.alert({content:u.dict&&u.dict.savedToNotebook?u.dict.savedToNotebook:"Saved to notebook!"})})}if(this.hasClass(e,"questions-preserve"))return document[l.id]||(document[l.id]={}),void(document[l.id].preserve=e.checked);for(var w=0,N=0,A=[],k=0;k<f.length;k++){var x=(b=f[k].getElementsByClassName("ans")).length>0,T=u.q[k];if(u.options.randomize&&(T=u.q[Number(f[k].getAttribute("data-o"))]),kInteractive.scorm&&u.options&&u.options.answerOnce&&kInteractive.scorm.interactionExists(kInteractive.getScormId(l.id+"-"+(k+1),T.q))){ae="<p style='text-align:center'>"+(u.dict.alreadySubmitted?u.dict.alreadySubmitted:"This test has already been submitted!")+"</p>";return void kInteractive.alert({content:ae})}var q={};A.push(q),q.id=kInteractive.getScormId(l.id+"-"+(k+1),T.q),q.qid=l.id,q.type=b[0].getAttribute("id").indexOf("ki-tf-")>=0?"true-false":"choice",q.objective=u.options?u.options.objective:null,q.timestamp=kInteractive.timestamp,q.latency=Math.round(((new Date).getTime()-kInteractive.timestamp.getTime())/1e3),q.description=T.q;for($=0;$<b.length;$++)if(b[$].getAttribute("id").indexOf("ki-tf-")>=0)0==$&&T.a?q.correctResponses=T.choice1:1!=$||T.a||(q.correctResponses=T.choice2),b[$].checked?(q.learnerResponses=$?T.choice2:T.choice1,0!=$||T.a?1==$&&T.a&&(x=!1):x=!1):0==$&&T.a?x=!1:1!=$||T.a||(x=!1),u.options&&u.options.highlightCorrect&&(0==$&&T.a||1==$&&!T.a)&&kInteractive.c.addClass(b[$].parentNode,"correct");else if(b[$].getAttribute("id").indexOf("ki-sa-")>=0){(X=b[$].value.toLowerCase())&&(X=X.trim()),x=!0;for(var L="",B=0;B<T.k.length;B++){var S=T.k[B].t;if(!S){x=!1;break}S=S.toLowerCase(),L&&(L+="+"),L+=S;for(var R=S.split(","),O=!1,H=0;H<R.length;H++)if(X.indexOf(R[H].trim())>=0){O=!0;break}if(!O){x=!1;break}}q.correctResponses=L,q.learnerResponses=X}else T.c[$].a&&(q.correctResponses=T.c[$].t),b[$].checked&&(q.learnerResponses=T.c[$].t),b[$].checked&&!T.c[$].a?x=!1:!b[$].checked&&T.c[$].a&&(x=!1),u.options&&u.options.highlightCorrect&&T.c[$].a&&kInteractive.c.addClass(b[$].parentNode,"correct");if(q.result=0,null!=T.weight&&(w+=T.weight,x&&(N+=T.weight,q.result=T.weight)),q.scoreMax=u.options?Number(u.options.totalScore):null,T.exp&&!f[k].getElementsByClassName("explanation").length){var M=document.createElement("p");M.className="explanation",M.innerHTML=kInteractive.escapeHtml(T.exp),f[k].appendChild(M)}var D=u.dict?u.dict.question.replace("[no]",k+1):"Question "+(k+1);x?(y+="<span style='border-bottom: dotted 1px #aaa;' title='"+T.q+"'>"+D+".</span>  <span style='color:#366c20'>"+u.dict.correct+"</span><br/>",v++):y+="<span style='border-bottom: dotted 1px #aaa;' title='"+T.q+"'>"+D+".</span>  <span style='color:#7a1818'>"+u.dict.incorrect+"</span><br/>"}for(k=0;k<A.length;k++)A[k].weighting=Math.round(1e3*u.options.totalScore/w)/1e3;var F,P=u.action;if(u.options.totalScore&&w&&(F=Math.round(10*u.options.totalScore*N/w)/10),"selfAnswer"==P||"selfAnswerReport"==P){var j="";"ar"==u.options.language&&(j=' direction="rtl"');ae="";if(u.dict){if(u.dict.scoreWeight&&null!=F){var z=F>u.options.passScore?u.dict.questionPass:u.dict.questionFail;z&&(z+=". "),ae+="<h3"+j+">"+(z||"")+u.dict.scoreWeight.replace("[score]",F).replace("[total]",u.options.totalScore)+"</h3>"}ae+="<p"+j+">"+u.dict.score.replace("[correct]",v).replace("[total]",g)+"</p>"}else ae="You scored "+v+" question(s) out of "+g;"selfAnswerReport"==P&&(ae="<p"+j+"><strong>"+ae+"</strong></p><p><strong>"+(u.dict?u.dict.details:"Details")+"</strong></p><p class='kbAlertScroll'>"+y+"</p>"),kInteractive.alert({content:ae}),i()}if("email"==P||u.options.reportEmail||u.options.emailForm){var K="selfAnswer"!=P&&"selfAnswerReport"!=P&&"email"!=P;try{if(!config.kotobee.cloudid)return void(K&&kInteractive.alert({content:u.dict.cloudOnly,title:u.dict?u.dict.sorry:"Sorry"}))}catch(e){return void(K&&kInteractive.alert({content:u.dict.cloudOnly,title:u.dict?u.dict.sorry:"Sorry"}))}var U={};U.ans=new Array;for($=0;$<f.length;$++)for(var b=f[$].getElementsByClassName("ans"),k=0;k<b.length;k++)b[k].checked&&U.ans.push({q:$,index:k,label:b[k].nextSibling.textContent||b[k].nextSibling.data});if(U.title=p,(le={}).recipient=u.address,le.content=JSON.stringify(U),le.mode=config.kotobee.mode,le.cloudid=config.kotobee.cloudid,le.email=config.kotobee.email?config.kotobee.email:angular.element(document.body).scope().data.user.email,u.options.emailForm){var W=document.getElementsByName("recipientEmail");W.length&&(le.recipient=le.recipient?le.recipient+","+W[0].value:W[0].value)}var V=e.value;e.value=u.dict?u.dict.submitting:"Submitting ..",e.setAttribute("disabled","true");var Y=new XMLHttpRequest;Y.onreadystatechange=function(){try{if(4===Y.readyState&&200===Y.status){if(e.value=V,e.removeAttribute("disabled"),!K)return;JSON.parse(Y.responseText).success?kInteractive.alert({content:u.dict?u.dict.submitted:"Answers submitted!"}):kInteractive.alert({content:u.dict?u.dict.errorSubmitting:"An error has occurred while sending answers to the server"})}}catch(t){if(e.value=V,e.setAttribute("value",e.value),e.removeAttribute("disabled"),!K)return;kInteractive.alert({content:u.dict?u.dict.errorSubmitting:"An error has occurred while sending answers to the server"})}};ne=config.kotobee.liburl?config.kotobee.liburl:"http://www.kotobee.com/";ne+="library/report/questions",Y.open("POST",ne),Y.setRequestHeader("Content-type","application/x-www-form-urlencoded");var Q="a=a";for(var J in le){var X=le[J];void 0!=X&&("object"!=typeof X&&("string"==typeof X&&(X=encodeURIComponent(X)),"boolean"==typeof X&&(X=X?1:0),Q+="&"+J+"="+X))}Y.send(Q),i()}document[l.id]||(document[l.id]={}),document[l.id].q=[];for(var G=l.getElementsByClassName("ques"),$=0;$<G.length;$++){var Z=$;u.options.randomize&&(Z=Number(G[$].getAttribute("data-o"))),document[l.id].q[Z]=[];for(var _=G[$].getElementsByClassName("ans"),k=0;k<_.length;k++)kInteractive.hasClass(_[k],"txtfield")?document[l.id].q[Z][k]=_[k].value:document[l.id].q[Z][k]=_[k].checked}kInteractive.scorm&&setTimeout(function(){kInteractive.scorm.setInteractions(A)},500)}else if(this.hasClass(l,"widget")){var ee,te=kInteractive.readData(l),ne=(ee=te.path?"undefined"==typeof isKotobee?te.path:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,te.path):"undefined"==typeof isKotobee?"../js/widgets/":bookPath+"EPUB/js/widgets/")+"/"+te.name+"/"+te.src,ie=document.createElement("iframe");ie.setAttribute("nwdisable","true"),ie.setAttribute("nwfaketop","true"),te.cb=function(e){ie.src=ne,e.appendChild(ie)},te.cb1="yes",te.closed=function(){},kInteractive.openFrame(te),kInteractive.tinCan({verb:"opened",activity:"Widget: "+te.name}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("widget",te.name),e.description="Opened popup widget: "+te.name,e.learnerResponses="Opened",e.type="other",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else{if(this.hasClass(e,"link")){if("popup"==(le=kInteractive.readData(e)).type){var ae="<div class='kbAlertScroll'>"+le.msg+"</div>";kInteractive.alert({content:ae}),kInteractive.scorm&&setTimeout(function(){var e={};e.id=kInteractive.getScormId("popup",le.msg),e.description="Shown popup message: "+le.msg,e.type="other",e.learnerResponses="Shown",e.timestamp=new Date,kInteractive.scorm.setInteractions([e])},800)}else if("audio"==le.type){kInteractive.stopCurrentMedia();var re=document.createElement("audio"),oe=le.src;"file"==le.audioType&&(oe="undefined"==typeof isKotobee?le.audio:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,le.audio)),re.setAttribute("src",oe);var se,ce=document.createElement("div");ce.className="kiAudioLoader",ce.style.transform="scale(1)";var de=document.createElement("div");de.className="kiAudioSpinner",ce.appendChild(de),e.parentNode.insertBefore(ce,e),re.onplaying=a,setTimeout(a,5e3),re.play(),kInteractive.currentAudio=re,kInteractive.tinCan({verb:"played",activity:"Audio: "+oe}),kInteractive.scorm&&((q={}).id=kInteractive.getScormId(e.textContent,oe),q.description="Played audio link: "+oe,q.type="other",q.learnerResponses="Played",q.objective=le.options?le.options.objective:null,q.timestamp=new Date,kInteractive.scorm.setInteractions([q]))}return!1}if(this.hasClass(e,"image")){if(e.parentNode&&this.hasClass(e.parentNode,"kInteractive")&&this.hasClass(e.parentNode,"link"))return void this.action(e.parentNode,t);var le=kInteractive.readData(e),ue=le.behavior;if("none"==ue)return;r(e,"none"),o(e,"none"),s(e,"none"),setTimeout(function(){function t(i){r(e,"none"),o(e,"none"),s(e,"none"),e.removeEventListener(n,t)}"wiggle"==ue?(r(e,"wiggle"),o(e,"0.5s"),s(e,"1")):"jump"==ue?(r(e,"jump"),o(e,"0.7s"),s(e,"1")):"scale"==ue&&(r(e,"scale"),o(e,"0.5s"),s(e,"1"));var n=function(){var e,t=document.createElement("fakeelement"),n={animation:"animationend",OAnimation:"oAnimationEnd",MozAnimation:"animationend",WebkitAnimation:"webkitAnimationEnd"};for(e in n)if(void 0!==t.style[e])return n[e]}();n&&e.addEventListener(n,t)}),kInteractive.tinCan({verb:"clicked",activity:ue+"image: "+e.getAttribute("src")})}else if(this.hasClass(l,"gallery")){var me=l.getElementsByClassName("images")[0],v=me.children.length,pe=l.getElementsByClassName("selected")[0],he=Number(pe.style.left.slice(0,-2)),ve=Number(me.style.left.slice(0,-2));if(this.hasClass(e,"next")){var fe=pe.nextSibling;if(!fe)return;kInteractive.c.removeClass(pe,"selected"),kInteractive.c.addClass(fe,"selected"),fe.style.left=he+l.offsetWidth+"px",fe.style.display="block",me.style.left=ve-l.offsetWidth+"px",fe.nextSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(l.getElementsByClassName("prev")[0],"disable")}else if(this.hasClass(e,"prev")){var ge=pe.previousSibling;if(!ge)return;kInteractive.c.removeClass(pe,"selected"),kInteractive.c.addClass(ge,"selected"),ge.style.left=he-l.offsetWidth+"px",ge.style.display="block",me.style.left=ve+l.offsetWidth+"px",ge.previousSibling?kInteractive.c.removeClass(e,"disable"):kInteractive.c.addClass(e,"disable"),kInteractive.c.removeClass(l.getElementsByClassName("next")[0],"disable")}}else if(this.hasClass(l,"audio")){kInteractive.stopCurrentMedia();var ye=kInteractive.readData(l);ye.audioType||(ye.audioType=ye.type);Ce=l.getAttribute("id")+"-container";(Ee=l.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn hide";oe=ye.src;"file"==ye.audioType&&(oe="undefined"==typeof isKotobee?ye.audio:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,ye.audio)),kInteractive.scorm&&((q={}).id=kInteractive.getScormId(l.getAttribute("id"),oe),q.description="Played audio: "+oe,q.type="other",q.learnerResponses="Played",q.objective=ye.options?ye.options.objective:null,q.timestamp=new Date,kInteractive.scorm.setInteractions([q]));var be=document.createElement("audio");be.setAttribute("controls","true"),be.setAttribute("autoplay","true"),be.setAttribute("data-tap-disabled","false");var ke=document.createElement("source");ke.src=oe,be.appendChild(ke),be.appendChild(document.createTextNode("Your browser does not support the audio element")),be.className="ki-noHighlight",be.oncanplay=function(){kInteractive.currentAudio==l&&kInteractive.tinCan({verb:"played",activity:"Audio: "+oe})},l.getElementsByClassName("container")[0].appendChild(be),be.play(),kInteractive.currentAudio=l,kInteractive.c.addClass(kInteractive.currentAudio,"playing")}else if(this.hasClass(l,"video")){var Ie=kInteractive.readData(l),Ce=l.getAttribute("id")+"-container",Ee=l.getElementsByClassName("playBtn")[0];if(Ee.className.indexOf("loading")>=0)return;if(kInteractive.stopCurrentMedia(),Ee.className="playBtn ki-btn loading",Ie.autoplay&&(Ee.className="playBtn ki-btn hide"),kInteractive.scorm&&((q={}).id=kInteractive.getScormId(l.getAttribute("id"),Ie.src),q.description="Played video: "+Ie.src,q.type="other",q.learnerResponses="Played",q.objective=Ie.options?Ie.options.objective:null,q.timestamp=new Date,kInteractive.scorm.setInteractions([q])),"file"==Ie.type)c(oe="undefined"==typeof isKotobee?Ie.video:ph.join(angular.element(document.body).scope().data.book.chapter.absoluteURL,Ie.video));else if(Ie.src.indexOf("youtube.com")>=0||Ie.src.indexOf("youtu.be/")>=0){var we;if(Ie.src.indexOf("youtube.com")>=0)we=(Ne=Ie.src.split("watch?v="))[1];else{if(!(Ie.src.indexOf("youtu.be/")>=0))return;var Ne=Ie.src.split("youtu.be/");we=Ne[Ne.length-1]}if(window&&window.iBooks)return setTimeout(function(){Ee.className="playBtn ki-btn"},1500),void(window.location.href=Ie.src);var Ae={videoId:we,playerVars:{autoplay:1,rel:"0"},events:{onReady:function(){},onStateChange:function(e){e.data==YT.PlayerState.PLAYING&&kInteractive.tinCan({verb:"played",activity:"Video: "+Ie.src})}}};if(kInteractive.youTubeStatus)if("loading"==kInteractive.youTubeStatus){if(kInteractive.vQueue)return;kInteractive.vQueue=function(){Ee.className="playBtn ki-btn hide",new YT.Player(Ce,Ae)}}else"ready"==kInteractive.youTubeStatus&&(Ee.className="playBtn ki-btn hide",new YT.Player(Ce,Ae));else{window.onYouTubePlayerAPIReady=function(){kInteractive.youTubeStatus="ready",kInteractive.vQueue(),kInteractive.vQueue=null};var xe=document.createElement("script");xe.src="https://www.youtube.com/player_api";var Te=document.getElementsByTagName("script")[0];Te.parentNode.insertBefore(xe,Te),kInteractive.youTubeStatus="loading",kInteractive.vQueue=function(){Ee.className="playBtn ki-btn hide",new YT.Player(Ce,Ae)}}}else c(Ie.src);kInteractive.currentVideo=l,kInteractive.c.addClass(kInteractive.currentVideo,"playing")}else if(this.hasClass(l,"threed")){var qe=kInteractive.readData(l);"inPanel"==qe.inter.target?kInteractive.c.addClass(l,"running"):l.innerHTML="";var Le=document.createElement("div");if(Le.className="loading",l.appendChild(Le),"undefined"==typeof THREE){var Be,Se=document.getElementsByTagName("head")[0],Re=Se.getElementsByTagName("script");if("undefined"!=typeof isKotobee)Be=bookPath+"EPUB/js/kotobeeInteractive3D.js";else for($=0;$<Re.length;$++)if(Re[$].src.indexOf("kotobeeinteractive.js")>=0){Be=Re[$].src.replace("kotobeeinteractive.js","kotobeeinteractive3D.js");break}if(!Be)return;var Oe=document.createElement("script");Oe.type="text/javascript",Oe.src=Be,Oe.onload=d,Oe.onreadystatechange=function(){"complete"==this.readyState&&d()},Se.appendChild(Oe)}else d()}}}},openFrame:function(e){function t(){i.style.display="block",i.className="show";var t=window.innerHeight||document.documentElement.clientHeight||document.getElementsByTagName("body")[0].clientHeight,r=window.innerWidth||document.documentElement.clientWidth||document.getElementsByTagName("body")[0].clientWidth;t-=20,r-=20;var o=1;if(e.width&&e.height){var s=r/e.width,d=t/e.height;(o=s<d?s:d)>1&&(o=1)}var l="display:block;";l+=a;var u=e.width||e.height?"-50%,-50%":"0%,0%";l+="-webkit-transform:translate("+u+") scale("+o+");-moz-transform:translate("+u+") scale("+o+");transform:translate("+u+") scale("+o+");",n.style.cssText=l,n.className=c+" ready";var m=n.getElementsByClassName("closeBtn");if(m.length){var p=m[0],h=1/o,v="-50%";kInteractive.hasClass(p,"side")&&(v="0%"),p.style.cssText="-webkit-transform: translate("+v+",0%) scale("+h+");-webkit-transform-origin: 50% 50%;-moz-transform: translate("+v+",0%) scale("+h+");-moz-transform-origin: 50% 50%;transform: translate("+v+",0%) scale("+h+");transform-origin: 50% 50%;"}}var n=document.getElementById("kInteractiveFrame"),i=document.getElementById("kiDarkOverlay"),a="";if(e.dict||(e.dict={}),e.width&&(a+="width:"+e.width+"px;max-width:"+e.width+"px;"),e.height&&(a+="height:"+e.height+"px;max-height:"+e.height+"px;"),n||((i=document.createElement("div")).id="kiDarkOverlay",document.body.appendChild(i),i.style.display="none",i.addEventListener("click",kInteractive.closeFrame),(n=document.createElement("div")).id="kInteractiveFrame"),e.pos||(e.pos="top"),"none"!=e.pos){var r=document.createElement("a"),o="closeBtn";e.pos&&(o+=" "+e.pos),r.className=o;var s=e.dict.close?e.dict.close:"Close";try{s=angular.element(document.body).scope().translit("close")}catch(e){}"side"!=e.pos&&(r.innerHTML=s),r.addEventListener("click",kInteractive.closeFrame),n.appendChild(r)}var c=e.class?e.class:"";(e.width||e.height)&&(c+=" fixed"),n.style.display="block",n.className=c,document.body.appendChild(n),kInteractive.frameIsOpen=!0,kInteractive.frameOb=e,kInteractive.openFrame.resized=t,window.addEventListener("resize",t),setTimeout(function(){t(),e.cb&&e.cb(n)},100)},closeAlert:function(e){e&&e.stopPropagation();var t=document.getElementById("kiSystemAlertBox"),n=document.getElementById("kiSystemAlertBackdrop");t.parentNode.removeChild(t),n.parentNode.removeChild(n),kInteractive.alertIsOpen=!1},closeFrame:function(){var e=document.getElementById("kInteractiveFrame"),t=document.getElementById("kiDarkOverlay");kInteractive.frameIsOpen=!1,window.removeEventListener("resize",kInteractive.openFrame.resized),kInteractive.openFrame.resized=null,kInteractive.c.removeClass(e,"ready");var n=kInteractive.frameOb,i="";n.width&&(i+="width:"+n.width+"px;max-width:"+n.width+"px;"),n.height&&(i+="height:"+n.height+"px;max-height:"+n.height+"px;"),e.style.cssText=i,t.className="",setTimeout(function(){e.innerHTML="",e.style.display=t.style.display="none",n.closed&&n.closed(),kInteractive.frameOb=null},300)},stopCurrentMedia:function(){if(kInteractive.currentVideo){var e=kInteractive.currentVideo.getAttribute("id")+"-container";(t=document.getElementById(e))&&(t.parentNode.removeChild(t),(n=document.createElement("div")).setAttribute("id",e),n.className="container",(i=kInteractive.currentVideo.getElementsByClassName("playBtn")[0]).className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentVideo,"playing"),kInteractive.currentVideo.appendChild(n))}if(kInteractive.currentAudio)if(e=kInteractive.currentAudio.getAttribute("id")){e+="-container";var t=document.getElementById(e);if(t){t.parentNode.removeChild(t);var n=document.createElement("div");n.setAttribute("id",e),n.className="container";var i=kInteractive.currentAudio.getElementsByClassName("playBtn")[0];i.className="playBtn ki-btn",kInteractive.c.removeClass(kInteractive.currentAudio,"playing"),kInteractive.currentAudio.appendChild(n)}}else try{kInteractive.currentAudio.pause(),kInteractive.currentAudio.src="";for(var a=document.getElementsByClassName("kiAudioLoader"),r=a.length;r--;)a[r].parentNode.removeChild(a[r])}catch(e){}},hasClass:function(e,t){if(e&&e.className)for(var n=e.className.trim().split(" "),i=0;i<n.length;i++)if(n[i]&&n[i].trim()==t)return!0},replaceHTML:function(e,t){var n="string"==typeof e?document.getElementById(e):e,i=n.cloneNode(!1);return i.innerHTML=t,n.parentNode.replaceChild(i,n),i},tinCan:function(e){if("undefined"!=typeof isKotobee)try{angular.element(document.body).scope().tinCanShortcut(e)}catch(e){}},setDOMParser:function(){!function(e){"use strict";var t=e.prototype,n=t.parseFromString;try{if((new e).parseFromString("","text/html"))return}catch(e){}t.parseFromString=function(e,t){if(/^\s*text\/html\s*(?:;|$)/i.test(t)){var i,a=document.implementation.createHTMLDocument(""),r=a.documentElement;return r.innerHTML=e,i=r.firstElementChild,1===r.childElementCount&&"html"===i.localName.toLowerCase()&&a.replaceChild(i,r),a}return n.apply(this,arguments)}}(DOMParser)},readData:function(e){try{var t=e.getAttribute("data-kotobee");return t||(t=e.getAttribute("data")),JSON.parse(decodeURI(kInteractive.XORCipher().decode("kotobee%%author",t)))}catch(e){try{return JSON.parse(kInteractive.XORCipher().decode("kotobee%%author",t))}catch(e){}}},writeData:function(e,t){var n=encodeURI(JSON.stringify(t)),i=e.hasAttribute("data-kotobee")?"data-kotobee":"data";e.setAttribute(i,kInteractive.XORCipher().encode("kotobee%%author",n))},XORCipher:function(){function e(e){var t,n,i,a,r,s,c=0,d="";if(!e)return e;do{t=(r=e[c++]<<16|e[c++]<<8|e[c++])>>18&63,n=r>>12&63,i=r>>6&63,a=63&r,d+=o.charAt(t)+o.charAt(n)+o.charAt(i)+o.charAt(a)}while(c<e.length);return((s=e.length%3)?d.slice(0,s-3):d)+"===".slice(s||3)}function t(e){var t,n,i,a,r,s,c=0,d=[];if(!e)return e;e+="";do{t=(s=o.indexOf(e.charAt(c++))<<18|o.indexOf(e.charAt(c++))<<12|(a=o.indexOf(e.charAt(c++)))<<6|(r=o.indexOf(e.charAt(c++))))>>16&255,n=s>>8&255,i=255&s,d.push(t),64!==a&&(d.push(n),64!==r&&d.push(i))}while(c<e.length);return d}function n(e,t){return e.charCodeAt(Math.floor(t%e.length))}function i(e,t){return r(t,function(t,i){return t.charCodeAt(0)^n(e,i)})}function a(e,t){return r(t,function(t,i){return String.fromCharCode(t^n(e,i))}).join("")}function r(e,t){for(var n=[],i=0;i<e.length;i++)n[i]=t(e[i],i);return n}var o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";return{encode:function(t,n){return n=i(t,n),e(n)},decode:function(e,n){return n=t(n),a(e,n)}}},getScormId:function(e,t){return t&&(t=t.replace(/[^a-zA-Z0-9]/g,"-").substr(0,80)),e+"-"+t},alert:function(e){var t=document.createElement("div");t.setAttribute("id","kiSystemAlertBox");var n=document.createElement("div");n.innerHTML=e.content,n.className="content",t.appendChild(n);var i=document.createElement("div");if(i.className="footer",e.title){var a=document.createElement("div");a.innerHTML=e.title,a.className="header",t.insertBefore(a,t.firstChild)}var r=document.createElement("a"),o="OK";try{o=angular.element(document.body).scope().translit("ok")}catch(e){}r.innerHTML=o,r.className="okBtn",kInteractive.alertIsOpen=!0,r.addEventListener("click",kInteractive.closeAlert),i.appendChild(r),t.appendChild(i);var s=document.createElement("div");s.setAttribute("id","kiSystemAlertBackdrop"),s.addEventListener("click",kInteractive.closeAlert),document.body.appendChild(s),document.body.appendChild(t),r.focus(),setTimeout(function(){t.className="show",s.className="show"},50)},c:{addClass:function(e,t){var n=e.className.trim();if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)-1==n.indexOf(t[a])&&(i=!1,n+=(""==n?"":" ")+t[a]);if(i)return}else{if(n.indexOf(t)>=0)return;n+=(""==n?"":" ")+t}e.className=n},removeClass:function(e,t){var n=e.className;if(t instanceof Array){for(var i=!0,a=0;a<t.length;a++)n.indexOf(t[a])>=0&&(i=!1,n=n.replace(t[a],""));if(i)return}else{if(-1==n.indexOf(t))return;n=n.replace(t,"")}""==(n=n.trim())?e.removeAttribute("class"):e.className=n},removeHash:function(e){return-1==e.indexOf("#")?e:e.substring(0,e.lastIndexOf("#"))},removeFilename:function(e){var t=kInteractive.c.normalizedArray(e);return-1==t[t.length-1].indexOf(".")?e:(t.splice(t.length-1,1),t.join("/"))},normalizedArray:function(e){for(var t=(e=e.replace(/\\/g,"/")).split("/"),n=t.length;n--;)t[n]?".."==t[n]&&n>0&&".."!=t[n-1]&&(t.splice(n,1),t.splice(n-1,1)):t.splice(n,1);return t[0].match(/http[s]?:$/g)&&(t[0]+="//"+t[1],t.splice(1,1)),"file:"==t[0]&&(t[0]+="///"+t[1],t.splice(1,1)),t}},escapeHtml:function(e){var t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.replace(/[&<>"']/g,function(e){return t[e]})},resizeEvent:function(e,t){function n(e,t){if(e.disableWrapForMobile&&"none"!=e.float){var n=t.parentNode;t.offsetWidth>.6*n.offsetWidth&&.4*(n.offsetWidth-t.offsetWidth)<100?kInteractive.c.addClass(t,"fullRow"):kInteractive.c.removeClass(t,"fullRow")}}var i,a=e||document;t&&(a=document);for(var r=(i=a.getElementsByClassName("kInteractive")).length;r--;){var o=i[r];if(this.hasClass(o,"image"))n(kInteractive.readData(o),o);else if(this.hasClass(o,"gallery"))n(kInteractive.readData(o),o);else if(this.hasClass(o,"container"))n(kInteractive.readData(o),o);else if(this.hasClass(o,"video")){var s=kInteractive.readData(o);if(n(s,o),!s.maintainRatio)continue;if("px"!=s.widthUnit)continue;if(!s.height||!s.width)continue;o.style.height=o.offsetWidth*(s.height/s.width)+"px"}else if(this.hasClass(o,"widget")){var c=kInteractive.readData(o);if("page"!=c.mode)continue;if("px"!=c.widthUnit)continue;var d=c.width,l=c.height,u=o.parentNode;if(!u)continue;if(d>u.offsetWidth){var m=u.offsetWidth/d,p=o.children.length-1;o.children[p].style.transform=o.children[p].style.webkitTransform=o.children[p].style.mozTransform="scale("+m+")",o.children[p].style.transformOrigin=o.children[p].style.webkitTransformOrigin=o.children[p].style.mozTransformOrigin="0 0",o.style.maxWidth=o.style.width,o.style.height=Math.round(l*m)+"px"}else{for(p=0;p<o.children.length;p++)o.children[p].style.transform=o.children[p].style.webkitTransform=o.children[p].style.mozTransform=o.children[p].style.transformOrigin=o.children[p].style.webkitTransformOrigin=o.children[p].style.mozTransformOrigin=null;o.style.maxWidth=null,o.style.height=l+"px"}}}},isMobile:function(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)},closeFullscreenVideo:function(){kInteractive.currentVideo&&(kInteractive.currentVideo.webkitExitFullscreen?kInteractive.currentVideo.webkitExitFullscreen():kInteractive.currentVideo.mozCancelFullScreen?kInteractive.currentVideo.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.mozCancelFullScreen&&document.mozCancelFullScreen(),kInteractive.videoIsFullscreen=!1)},vQueue:[],youTubeReady:!1,firstRun:!0};if("undefined"==typeof isKotobee)try{document.addEventListener("DOMContentLoaded",kInteractionStart,!1)}catch(e){window.addEventListener("load",kInteractionStart,!1)}